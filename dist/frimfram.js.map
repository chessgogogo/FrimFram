{"version":3,"sources":["src/init.coffee","src/BaseClass.coffee","src/View.coffee","src/Application.coffee","src/Collection.coffee","src/ModalView.coffee","src/Model.coffee","src/RootView.coffee","src/Router.coffee","src/network-error-callbacks.coffee","src/storage.coffee"],"names":[],"mappings":"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","file":"dist/frimfram.js","sourcesContent":["window.FrimFram = {\n  isProduction: -> window.location.href.indexOf('localhost') is -1\n    \n  wrapBackboneRequestCallbacks: (options) ->\n    options ?= {}\n    originalOptions = _.clone(options)\n    options.success = (model) ->\n      model.dataState = 'standby'\n      originalOptions.success?(arguments...)\n    options.error = (model) ->\n      model.dataState = 'standby'\n      originalOptions.error?(arguments...)\n    options.complete = (model) ->\n      model.dataState = 'standby'\n      originalOptions.complete?(arguments...)\n    return options\n}\n","class BaseClass\n  superMerge: (propertyName) ->\n    combined = {}\n    obj = @\n    while obj\n      value = obj?[propertyName]\n      _.defaults(combined, value)\n      obj = obj.__proto__ or Object.getPrototypeOf(obj)\n    combined\n\n  listenToShortcuts: ->\n    shortcuts = @superMerge('shortcuts')\n    if @scope\n      @stopListeningToShortcuts()\n    else\n      @scope = _.uniqueId('class-scope-')\n    for shortcut, func of shortcuts\n      func = @[func] if not _.isFunction(func)\n      continue unless func\n      key(shortcut, @scope, _.bind(func, @))\n\n  stopListeningToShortcuts: ->\n    key.deleteScope(@scope)\n\n  destroy: ->\n    @off() # clear Backbone Events\n    @stopListeningToShortcuts() # clear keymaster shortcuts\n    delete @[key] for key of @ # salt the earth\n    @destroyed = true\n    @destroy = _.noop\n\n_.extend(BaseClass.prototype, Backbone.Events)\n\nFrimFram.BaseClass = BaseClass","\nclass View extends Backbone.View\n\n  template: ''\n  shortcuts: {}\n  @globalContext = {\n    'moment': window.moment\n  }\n  @extendGlobalContext: (globals) -> @globalContext = _.extend(@globalContext, globals)\n\n\n  #- Setup\n\n  constructor: (options) ->\n    @events = @superMerge('events')\n    @subviews = {}\n    @listenToShortcuts()\n    super arguments...\n\n\n  #- Rendering functions\n\n  render: ->\n    # reset subviews\n    view.destroy() for id, view of @subviews\n    @subviews = {}\n    @$el.html @getTemplateResult()\n    @onRender()\n\n  renderSelectors: (selectors...) ->\n    newTemplate = $('<div>'+@getTemplateResult()+'</div>')\n    for selector, i in selectors\n      for elPair in _.zip(@$el.find(selector), newTemplate.find(selector))\n        $(elPair[0]).replaceWith($(elPair[1]))\n\n  getTemplateResult: ->\n    if _.isString(@template) then @template else @template(@getContext())\n\n  initContext: (pickPredicate) ->\n    context = {}\n    context.pathname = document.location.pathname  # ex. '/play/level'\n    context = _.defaults context, View.globalContext\n    context = _.extend context, _.pick(@, pickPredicate, @) if pickPredicate\n    context\n\n  getContext: -> @initContext()\n\n\n  #- Callbacks\n\n  onRender: _.noop # Good place to insert subviews\n\n  onInsert: _.noop # Called when view is inserted into the DOM\n\n\n  #- Shortcuts\n\n  listenToShortcuts: (recurse) ->\n    shortcuts = @superMerge('shortcuts')\n    if @scope\n      @stopListeningToShortcuts()\n    else\n      @scope = _.uniqueId('view-scope-')\n    for shortcut, func of @shortcuts\n      func = @[func] if not _.isFunction(func)\n      continue unless func\n      key(shortcut, @scope, _.bind(func, @))\n    if recurse\n      for viewID, view of @subviews\n        view.listenToShortcuts(true)\n\n  stopListeningToShortcuts: (recurse) ->\n    key.deleteScope(@scope)\n    if recurse\n      for viewID, view of @subviews\n        view.stopListeningToShortcuts(true)\n\n\n  #- Subviews\n\n  insertSubview: (view, elToReplace=null) ->\n    # used to insert views with ids\n    key = @makeSubviewKey(view)\n    oldSubview = @subviews[key]\n    elToReplace ?= @$el.find('#'+view.id)\n    if not elToReplace.length\n      throw new Error('Error inserting subview: do not have element for it to replace.')\n    elToReplace.after(view.el).remove()\n    @registerSubview(view, key)\n    view.render()\n    view.onInsert()\n    oldSubview?.destroy()\n    view\n\n  registerSubview: (view, key) ->\n    # used to register views which are custom inserted into the view,\n    # like views where you add multiple instances of them\n    key ?= @makeSubviewKey(view)\n    @subviews[key] = view\n    view\n\n  makeSubviewKey: (view) ->\n    key = view.id or (_.uniqueId(view.constructor.name))\n    key = _.underscored(key)  # handy for autocomplete in dev console\n    key\n\n  removeSubview: (view) ->\n    view.$el.empty()\n    newEl = view.$el.clone()\n    view.$el.replaceWith(newEl)\n    key = _.findKey @subviews, (v) -> v is view\n    delete @subviews[key] if key\n    view.destroy()\n\n\n  #- Utilities\n\n  getQueryParam: (param) ->\n    View.getQueryParam(param)\n\n  @getQueryParam: (param) ->\n    query = @getQueryString()\n    pairs = (pair.split('=') for pair in query.split '&')\n    for pair in pairs when pair[0] is param\n      return decodeURIComponent(pair[1].replace(/\\+/g, '%20'))\n    return\n\n  @getQueryString: -> document.location.search.substring 1\n\n\n  #- Teardown\n\n  destroy: ->\n    @remove()\n    @stopListeningToShortcuts()\n    view.destroy() for view in _.values(@subviews)\n    delete @[key] for key, value of @\n    @destroyed = true\n    @destroy = _.noop\n\n_.defaults(View.prototype, FrimFram.BaseClass.prototype)\n\nFrimFram.View = FrimFram.BaseView = View\n","class Application extends FrimFram.BaseClass\n  @extend: Backbone.Model.extend\n\n  #- Initialization\n\n  constructor: ->\n    @watchForErrors()\n    _.mixin(s.exports())\n    $(document).bind 'keydown', @preventBackspace\n    @handleNormalUrls()\n    @initialize(arguments...)\n\n  initialize: _.noop\n\n  start: ->\n    Backbone.history.start({ pushState: true })\n\n\n  #- Error reporting\n\n  watchForErrors: ->\n    window.addEventListener \"error\", (e) ->\n      return if $('body').find('.runtime-error-alert').length\n      alert = $(FrimFram.runtimeErrorTemplate({errorMessage: e.error.message}))\n      $('body').append(alert)\n      alert.addClass('in')\n      alert.alert()\n\n\n  #- Backspace navigation stopping\n\n  # Prevent Ctrl/Cmd + [ / ], P, S\n  @ctrlDefaultPrevented: [219, 221, 80, 83]\n  preventBackspace: (event) =>\n    if event.keyCode is 8 and not @elementAcceptsKeystrokes(event.srcElement or event.target)\n      event.preventDefault()\n    else if (key.ctrl or key.command) and not key.alt and event.keyCode in Application.ctrlDefaultPrevented\n      event.preventDefault()\n\n  elementAcceptsKeystrokes: (el) ->\n    # http://stackoverflow.com/questions/1495219/how-can-i-prevent-the-backspace-key-from-navigating-back\n    el ?= document.activeElement\n    tag = el.tagName.toLowerCase()\n    type = el.type?.toLowerCase()\n    textInputTypes = ['text', 'password', 'file', 'number', 'search', 'url', 'tel', 'email', 'date', 'month', 'week', 'time', 'datetimelocal']\n    # not radio, checkbox, range, or color\n    return (tag is 'textarea' or (tag is 'input' and type in textInputTypes) or el.contentEditable in ['', 'true']) and not (el.readOnly or el.disabled)\n\n\n  #- Single-page web app URLs w/out hashbang\n\n  handleNormalUrls: ->\n    # http://artsy.github.com/blog/2012/06/25/replacing-hashbang-routes-with-pushstate/\n    $(document).on 'click', \"a[href^='/']\", (event) ->\n      href = $(event.currentTarget).attr('href')\n      passThrough = href.indexOf('sign_out') >= 0\n      if !passThrough && !event.altKey && !event.ctrlKey && !event.metaKey && !event.shiftKey\n        event.preventDefault()\n        url = href.replace(/^\\//,'').replace('\\#\\!\\/','')\n        app.router.navigate url, { trigger: true }\n        return false\n\n\nFrimFram.Application = Application","class Collection extends Backbone.Collection\n\n  dataState: 'standby' # or 'fetching'\n\n  constructor: (models, options) ->\n    super(models, options)\n    if options?.defaultFetchData\n      @defaultFetchData = options.defaultFetchData\n\n  fetch: (options) ->\n    @dataState = 'fetching'\n    options = FrimFram.wrapBackboneRequestCallbacks(options)\n    if @defaultFetchData\n      options.data ?= {}\n      _.defaults(options.data, @defaultFetchData)\n    return super(options)\n\n  # At some later point, create save, patch, destroy methods?\n\n\nFrimFram.BaseCollection = FrimFram.Collection = Collection","class ModalView extends FrimFram.View\n  @visibleModal: null\n\n  className: 'modal fade'\n  destroyOnHidden: true\n\n  onRender: ->\n    super()\n\n    # proxy Bootstrap events to Backbone View events\n    modal = @\n    @$el.on 'show.bs.modal', -> modal.trigger 'show'\n    @$el.on 'shown.bs.modal', ->\n      modal.onInsert()\n      modal.trigger 'shown'\n    @$el.on 'hide.bs.modal', -> modal.trigger 'hide'\n    @$el.on 'hidden.bs.modal', -> modal.onHidden()\n    @$el.on 'loaded.bs.modal', -> modal.trigger 'loaded'\n\n  hide: (fast) ->\n    @$el.removeClass('fade') if fast\n    @$el.modal('hide')\n\n  show: (fast) ->\n    ModalView.visibleModal?.hide(true)\n    @render()\n    @$el.removeClass('fade') if fast\n    $('body').append @$el\n    @$el.modal('show')\n    ModalView.visibleModal = @\n\n  toggle: -> @$el.modal('toggle')\n\n  onHidden: ->\n    ModalView.visibleModal = null if ModalView.visibleModal is @\n    @trigger 'hidden'\n    @destroy() if @destroyOnHidden\n\nFrimFram.ModalView = ModalView","class Model extends Backbone.Model\n  \n  constructor: (attributes, options) ->\n    super(attributes, options)\n    @on 'add', @onAdded, @\n    @on 'invalid', @onInvalid, @  \n\n  dataState: 'standby' # or 'fetching', 'saving'\n\n  created: -> new Date(parseInt(@id.substring(0, 8), 16) * 1000)\n\n  onAdded: -> @dataState = 'standby'\n\n  schema: ->\n    s = @constructor.schema\n    if _.isString s then app.ajv.getSchema(s)?.schema else s\n\n  onInvalid: ->\n    console.debug \"Validation failed for #{@constructor.className or @}: '#{@get('name') or @}'.\"\n    for error in @validationError\n      console.debug \"\\t\", error.dataPath, ':', error.message\n\n  set: (attributes, options) ->\n    if (@dataState isnt 'standby') and not (options.xhr or options.headers)\n      throw new Error('Cannot set while fetching or saving.')\n\n    return super(attributes, options)\n\n  getValidationErrors: ->\n    valid = app.ajv.validate(@constructor.schema or {}, @attributes)\n    return app.ajv.errors if not valid\n\n  validate: -> @getValidationErrors()\n\n  save: (attrs, options) ->\n    options = FrimFram.wrapBackboneRequestCallbacks(options)\n    result = super(attrs, options)\n    @dataState = 'saving' if result\n    return result\n\n  fetch: (options) ->\n    options = FrimFram.wrapBackboneRequestCallbacks(options)\n    @dataState = 'fetching'\n    return super(options)\n\n\n\nFrimFram.BaseModel = FrimFram.Model = Model","class RootView extends FrimFram.View\n\n  onInsert: ->\n    super(arguments...)\n    title = _.result(@, 'title') or _.result(RootView, 'globalTitle') or @constructor.name\n    $('title').text(title)\n\n  title: _.noop\n\n  @globalTitle: _.noop\n\n  onLeaveMessage: _.noop\n\nFrimFram.RootView = RootView","class Router extends Backbone.Router\n  @go = (path) -> -> @routeDirectly path, arguments\n\n  #- Routing functions\n\n  routeToServer: ->\n    window.location.reload(true)\n\n  routeDirectly: (path, args) ->\n    return document.location.reload() if @currentView?.reloadOnClose\n    leavingMessage = _.result(@currentView, 'onLeaveMessage')\n    if leavingMessage\n      if not confirm(leavingMessage)\n        return @navigate(this.currentPath, {replace: true})\n\n    path = \"views/#{path}\"\n\n    try\n      ViewClass = require(path)\n    catch error\n      if error.toString().search('Cannot find module \"' + path + '\" from') is -1\n        throw error\n\n    ViewClass ?= NotFoundView\n    view = new ViewClass({params: args})\n    @openView(view)\n\n  #- Opening, closing views\n\n  openView: (view) ->\n    @closeCurrentView()\n    view.render()\n    $('body').empty().append(view.el)\n    @currentView = view\n    @currentPath = document.location.pathname + document.location.search\n    view.onInsert()\n\n  closeCurrentView: -> @currentView?.destroy()\n\n  setupOnLeaveSite: ->\n    window.addEventListener \"beforeunload\", (e) =>\n      leavingMessage = _.result(@currentView, 'onLeaveMessage')\n      if leavingMessage\n        e.returnValue = leavingMessage\n        return leavingMessage\n\nFrimFram.Router = Router","\n#- Error handling\nFrimFram.onNetworkError = ->\n  jqxhr = _.find arguments, (arg) -> arg.promise? and arg.getResponseHeader? # duck typing\n\n  r = jqxhr?.responseJSON\n  if jqxhr?.status is 0\n    s = 'Network failure'\n  else if arguments[2]?.textStatus is 'parsererror'\n    s = 'Backbone parser error'\n  else\n    s = r?.message or r?.error or 'Unknown error'\n\n  if r\n    console.error 'Response JSON:', JSON.stringify(r, null, '\\t')\n  else\n    console.error 'Error arguments:', arguments\n\n  alert = $(FrimFram.runtimeErrorTemplate({errorMessage: s}))\n  $('body').append(alert)\n  alert.addClass('in')\n  alert.alert()\n\n# deprecated, just use onNetworkError everywhere\nFrimFram.onAjaxError = FrimFram.onNetworkError\nFrimFram.onModelError = FrimFram.onNetworkError\n\nFrimFram.runtimeErrorTemplate = _.template(\"\"\"\n  <div class=\"runtime-error-alert alert alert-danger fade\">\n    <button class=\"close\" type=\"button\" data-dismiss=\"alert\">\n      <span aria-hidden=\"true\">&times;</span>\n    </button>\n    <span><%= errorMessage %></span>\n  </div>\n\"\"\")\n\n","FrimFram.storage = {\n  prefix: '-storage-'\n  \n  load: (key) ->\n    s = localStorage.getItem(@prefix+key)\n    unless s\n      return null\n    try\n      value = JSON.parse(s)\n      return value\n    catch SyntaxError\n      console.warn('error loading from storage', key)\n      return null\n  \n  save: (key, value) ->\n    localStorage.setItem(@prefix+key, JSON.stringify(value))\n  \n  remove: (key) ->\n    localStorage.removeItem(@prefix+key)\n    \n  clear: ->\n    for key of localStorage\n      if key.indexOf(@prefix) is 0\n        localStorage.removeItem(key)\n}\n"]}